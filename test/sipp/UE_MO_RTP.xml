<?xml version="2.0" encoding="ISO-8859-1" ?>
<!DOCTYPE scenario SYSTEM "sipp.dtd">

<scenario name="Basic Sipstone UAC">
  <!-- In client mode (sipp placing calls), the Call-ID MUST be         -->
  <!-- generated by sipp. To do so, use [call_id] keyword.                -->
  <send >
    <![CDATA[

      REGISTER sip:[field2] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      From: <sip:[field0]@[field2]>;tag=[call_number]
      To: <sip:[field0]@[field2]>
      Call-ID: [field0]///[call_id]
      CSeq: [cseq+4] REGISTER
      Contact: <sip:[field0]@[local_ip]:[local_port];transport=[transport]>;+g.3gpp.icsi-ref="urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel,urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel.gsma.videocall";audio;video;q=0.8;+g.oma.sip-im;+g.oma.sip-im.large-message;expires=3600
      Max-Forwards: 70
      Path: <sip:[field0]@[local_ip]:[local_port];lr>
      P-Visited-Network-Id: [field2]
      Authorization: Digest username="31030[field0]@[field2]", realm="[field2]", nonce="", uri="sip:[field2]", response="", integrity-protected="no", algorithm=AKAv1-MD5
      Allow: INVITE,BYE,CANCEL,ACK,SUBSCRIBE,NOTIFY,PUBLISH,MESSAGE,REFER,REGISTER,UPDATE
      Supported: join,replaces
      Content-Type: application/3gpp-ims+xml
      Content-Length: [len]

      <ims-3gpp version="1">
      <serviceInfo>Latitude=36.5;Longitude=-77;Uncertainty=150;imeisv=123456789012345</serviceInfo>
      <IMSI>31030[field0]</IMSI>
      <UE-IP>[local_ip]</UE-IP>
      </ims-3gpp>

    ]]>
  </send>


  <recv response="401" auth="true">
  </recv>


  <send >
    <![CDATA[

      REGISTER sip:[field2] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      From: <sip:[field0]@[field2]>;tag=[call_number]
      To: <sip:[field0]@[field2]>
      Call-ID: [field0]///[call_id]
      CSeq: [cseq] REGISTER
      Contact: <sip:[field0]@[local_ip]:[local_port];transport=[transport]>;+g.3gpp.icsi-ref="urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel,urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel.gsma.videocall";audio;video;q=0.8;+g.oma.sip-im;+g.oma.sip-im.large-message;expires=3600
      , integrity-protected="yes"
      Max-Forwards: 70
      Path: <sip:[field0]@[local_ip]:[local_port];lr>
      P-Visited-Network-Id: [field2]
      Allow: INVITE,BYE,CANCEL,ACK,SUBSCRIBE,NOTIFY,PUBLISH,MESSAGE,REFER,REGISTER,UPDATE
      Supported: join,replaces
      Content-Type: application/3gpp-ims+xml
      Content-Length: [len]

      <ims-3gpp version="1">
      <serviceInfo>Latitude=36.5;Longitude=-77;Uncertainty=150;imeisv=123456789012345</serviceInfo>
      <IMSI>31030[field0]</IMSI>
      <UE-IP>[local_ip]</UE-IP>
      </ims-3gpp>

    ]]>
  </send>

  <recv response="200" rtd="1" rrs="true">
  <action>
    <ereg regexp=".*" search_in="hdr" header="Service-Route:" check_it="true" assign_to="1"/>
    </action>
  </recv>


   <send>
    <![CDATA[

      INVITE sip:1[field0]@[field2] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      Max-Forwards: 70
      Call-ID: caller[field0]///[call_id]
      From: <sip:[field0]@[field2]>;tag=[pid]UEMO[call_number]
      To: <sip:1[field0]@[field2]>
      CSeq: 1 INVITE
      Expires: 700
      Allow: INVITE,ACK,CANCEL,OPTIONS,NOTIFY,PRACK,UPDATE,BYE
      Route: <sip:[remote_ip]:[remote_port];lr>,[$1]
      Supported: 100rel,eventlist
      User-Agent: SIPP
      Content-Type: application/sdp
      P-Asserted-Identity: <sip:[field0]@[field2]>
      P-Access-Network-Info: Mav-Access-Network-Info
      Contact: <sip:[field0]@[local_ip]:[local_port];transport=[transport]>;+g.3gpp.icsi-ref="urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel,urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel.gsma.videocall";audio;video;q=0.8;+g.oma.sip-im;+g.oma.sip-im.large-message
      Content-Length: [len]

  v=0
  o=user1 53655765 2353687637 IN IP4 [local_ip]
  s=-
  c=IN IP4 [local_ip]
  t=0 0
  m=audio [auto_media_port] RTP/AVP 8 101
  a=rtpmap:8 PCMA/8000
  a=rtpmap:101 telephone-event/8000
  a=fmtp:101 0-11,16



    ]]>
  </send>
  <recv response="100" optional="true">
  </recv>

  <recv response="180" optional="true">
  </recv>

  <recv response="200" rrs="true">
    <action>
    <ereg regexp="sip:[0-9a-zA-Z@;.,:=-]*" search_in="hdr" header="Contact:" check_it="true" assign_to="2"/>
    </action>
  </recv>

  <send>
    <![CDATA[

      ACK [$2] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      [routes]
      [last_From:]
      [last_To:]
      [last_Call-ID:]
      CSeq: 1 ACK
      Contact: <sip:[field0]@[local_ip]:[local_port];transport=[transport]>
      Max-Forwards: 70
      Content-Length: 0]]>
  </send>

   <nop>
    <action>
	    <exec play_pcap_audio="/home/ubuntu/test/sipp/reg_call/g711a.pcap"/>
    </action>
  </nop>

  <pause milliseconds="12500"/> 

   <send>
    <![CDATA[

      BYE [$2] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      [last_From:]
      [last_To:]
      [last_Call-ID:]
      [routes]
      CSeq: 3 BYE
      Max-Forwards: 70
      Content-Length: 0

    ]]>
  </send>

  <recv response="200" crlf="true">
  </recv>
<pause milliseconds="500"/>
    <send >
      <![CDATA[

      REGISTER sip:[field2] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      From: <sip:[field0]@[field2]>;tag=[call_number]
      To: <sip:[field0]@[field2]>
      Call-ID: [field0]///[call_id]
      CSeq: [cseq+6] REGISTER
      Contact: <sip:[field0]@[local_ip]:[local_port];transport=[transport]>;+g.3gpp.icsi-ref="urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel,urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel.gsma.videocall";audio;video;q=0.8;+g.oma.sip-im;+g.oma.sip-im.large-message;expires=0
      Max-Forwards: 70
      Path: <sip:[field0]@[local_ip]:[local_port];lr>
      P-Visited-Network-Id: [field2]
      Authorization: Digest username="31030[field0]@[field2]", realm="[field2]", nonce="", uri="sip:[field2]", response="", integrity-protected="no", algorithm=AKAv1-MD5
      Allow: INVITE,BYE,CANCEL,ACK,SUBSCRIBE,NOTIFY,PUBLISH,MESSAGE,REFER,REGISTER,UPDATE
      Supported: join,replaces
      Content-Type: application/3gpp-ims+xml
      Content-Length: [len]

      <ims-3gpp version="1">
      <serviceInfo>Latitude=36.5;Longitude=-77;Uncertainty=150;imeisv=123456789012345</serviceInfo>
      <IMSI>31030[field0]</IMSI>
      <UE-IP>[local_ip]</UE-IP>
      </ims-3gpp>

    ]]>
  </send>

  <recv response="480" rrs="true" optional="true" >
  </recv>

  <recv response="401" auth="true">
  </recv>


  <send >
      <![CDATA[

      REGISTER sip:[field2] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      From: <sip:[field0]@[field2]>;tag=[call_number]
      To: <sip:[field0]@[field2]>
      Call-ID: [field0]///[call_id]
      CSeq: [cseq] REGISTER
      Contact: <sip:[field0]@[local_ip]:[local_port];transport=[transport]>;+g.3gpp.icsi-ref="urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel,urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel.gsma.videocall";audio;video;q=0.8;+g.oma.sip-im;+g.oma.sip-im.large-message;expires=0
      [field1], integrity-protected="yes"
      Max-Forwards: 70
      Path: <sip:[field0]@[local_ip]:[local_port];lr>
      P-Visited-Network-Id: [field2]
      Allow: INVITE,BYE,CANCEL,ACK,SUBSCRIBE,NOTIFY,PUBLISH,MESSAGE,REFER,REGISTER,UPDATE
      Supported: join,replaces
      Content-Type: application/3gpp-ims+xml
      Content-Length: [len]

      <ims-3gpp version="1">
      <serviceInfo>Latitude=36.5;Longitude=-77;Uncertainty=150;imeisv=123456789012345</serviceInfo>
      <IMSI>31030[field0]</IMSI>
      <UE-IP>[local_ip]</UE-IP>
      </ims-3gpp>

    ]]>
  </send>

  <recv response="480" rrs="true" optional="true" >
  </recv>

  <recv response="200" auth="true">
  </recv>

  <pause milliseconds="500"/>

  <!-- definition of the response time repartition table (unit is ms)   -->
  <ResponseTimeRepartition value="10, 20, 30, 40, 50, 100, 150, 200"/>

  <!-- definition of the call length repartition table (unit is ms)     -->
  <CallLengthRepartition value="10, 50, 100, 500, 1000, 5000, 10000"/>

</scenario>
